(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{435:function(s,e,a){"use strict";a.r(e);var t=a(2),r=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/img/blog/20220323173634.png"}})]),s._v(" "),e("h2",{attrs:{id:"一、安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、安装docker"}},[s._v("#")]),s._v(" 一、安装Docker")]),s._v(" "),e("p",[s._v("本人电脑为mac，直接下载docker dmg文件")]),s._v(" "),e("p",[s._v("Linux查看"),e("a",{attrs:{href:"/docker/centosseven"}},[s._v("此处")])]),s._v(" "),e("h2",{attrs:{id:"二、获取redis镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、获取redis镜像"}},[s._v("#")]),s._v(" 二、获取redis镜像")]),s._v(" "),e("div",{staticClass:"language-vim line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-vim"}},[e("code",[s._v("docker search redis\n\ndocker pull redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n\ndocker images\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"三、创建容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、创建容器"}},[s._v("#")]),s._v(" 三、创建容器")]),s._v(" "),e("h3",{attrs:{id:"_1、新建一个redis目录，用于存放redis-conf"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、新建一个redis目录，用于存放redis-conf"}},[s._v("#")]),s._v(" 1、新建一个redis目录，用于存放redis.conf")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" onlineinternship/redis\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_2、下载redis官方配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、下载redis官方配置文件"}},[s._v("#")]),s._v(" 2、下载redis官方配置文件")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://link.segmentfault.com/?enc=0UODtStvvZBKPuzW9hd7JQ%3D%3D.gDpM6iOXS2%2BUdAX%2Fu3tvgIAUsCmvyVm0RnO0o81etK2LEL4AGEaDWFNjz3Nh%2Ftk9jhfOsx40CxH8xXOq0RENxw%3D%3D",target:"_blank",rel:"noopener noreferrer"}},[s._v("redis配置文件"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"_3、修改配置项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、修改配置项"}},[s._v("#")]),s._v(" 3、修改配置项")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释掉这部分，这是限制redis只能本地访问")]),s._v("\n\nprotected-mode no "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认yes，开启保护模式，限制为本地访问")]),s._v("\n\ndaemonize no"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程，改为yes会使配置文件方式启动redis失败")]),s._v("\n\ndatabases "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据库个数（可选），我修改了这个只是查看是否生效。。")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v("  ./ "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入本地redis数据库存放文件夹（可选）")]),s._v("\n\nappendonly "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redis持久化（可选）")]),s._v("\n\nlogfile "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"access.log"')]),s._v("\n\nrequirepass "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("设置成你自己的密码"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("protected-mode 是在没有显示定义 bind 地址（即监听全网断），又没有设置密码 requirepass\n时，protected-mode 只允许本地回环 127.0.0.1 访问。\n也就是说当开启了 protected-mode 时，如果你既没有显示的定义了 bind 监听的地址，同时又没有设置 auth 密码。那你只能通过 127.0.0.1 来访问 redis 服务。")]),s._v(" "),e("h3",{attrs:{id:"_4、创建并命名一个叫做myredis的容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、创建并命名一个叫做myredis的容器"}},[s._v("#")]),s._v(" 4、创建并命名一个叫做myredis的容器")]),s._v(" "),e("div",{staticClass:"language-gradle line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-gradle"}},[e("code",[s._v("docker run \\\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name myredis \\\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/Users/")])]),s._v("bochenghu"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/onlineinternship/")])]),s._v("redis"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/redis.conf:/")])]),s._v("etc"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/redis/")])]),s._v("redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \\\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/Users/")])]),s._v("bochenghu"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/onlineinternship/")])]),s._v("redis"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/data:/")])]),s._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("rw \\\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("privileged"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d redis redis"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server "),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/etc/")])]),s._v("redis"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \\\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("appendonly yes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("参数解释说明：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("-p 6379:6379 端口映射：前表示主机部分，：后表示容器部分。")])]),s._v(" "),e("li",[e("p",[s._v("--name myredis 指定该容器名称，查看和进行操作都比较方便。")])]),s._v(" "),e("li",[e("p",[s._v("-v 挂载配置文件目录，规则与端口映射相同。\n为什么需要挂载目录：个人认为docker是个沙箱隔离级别的容器，这个是它的特点及安全机制，不能随便访问外部（主机）资源目录，所以需要这个挂载目录机制。\n例： -v /usr/local/docker/redis/redis.conf:/etc/redis/redis.conf 容器 /etc/redis/redis.conf 配置文件 映射宿主机 /usr/local/docker/redis/redis.conf。 会将宿主机的配置文件复制到docker中\n"),e("strong",[s._v("重要： 配置文件映射，docker镜像redis 默认无配置文件。")])])]),s._v(" "),e("li",[e("p",[s._v("-v 挂在数据卷\n/Users/bochenghu/onlineinternship/redis/data:/data:rw\n映射数据目录 rw 为读写")])]),s._v(" "),e("li",[e("p",[s._v("-d redis 表示后台启动redis")])]),s._v(" "),e("li",[e("p",[s._v("redis-server /etc/redis/redis.conf 以配置文件启动redis，加载容器内的conf文件，最终找到的是挂载的目录/usr/local/docker/redis/redis.conf\n"),e("strong",[s._v("重要: docker 镜像redis 默认 无配置文件启动")])])]),s._v(" "),e("li",[e("p",[s._v("--appendonly yes 开启redis 持久化")]),s._v(" "),e("h3",{attrs:{id:"_5、查看活跃的容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、查看活跃的容器"}},[s._v("#")]),s._v(" 5、查看活跃的容器")]),s._v(" "),e("div",{staticClass:"language-mipsasm line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 查看活跃的容器\ndocker ps\n# 如果没有 myredis 说明启动失败 查看错误日志\ndocker logs myredis\n# 查看 myredis 的 ip 挂载 端口映射等信息\ndocker inspect myredis\n# 查看 myredis 的端口映射\ndocker port myredis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h2",{attrs:{id:"四、外部访问redis容器服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、外部访问redis容器服务"}},[s._v("#")]),s._v(" 四、外部访问redis容器服务")]),s._v(" "),e("div",{staticClass:"language-applescript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-applescript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli 访问")]),s._v("\ndocker run "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("it")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--link myredis:redis --rm redis redis-cli -h redis -p 6379")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -it 交互的虚拟终端")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--rm 退出是删除此容器")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("或者使用 shell 登录容器内操作")]),s._v(" "),e("div",{staticClass:"language-applescript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-applescript"}},[e("code",[s._v("docker exec "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("it")]),s._v(" myredis bash\nredis"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cli\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("配置完成")]),s._v(" "),e("h2",{attrs:{id:"五、主从配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、主从配置"}},[s._v("#")]),s._v(" 五、主从配置")]),s._v(" "),e("p",[s._v("新建一个redis-slave容器(同新建redis)")]),s._v(" "),e("div",{staticClass:"language-gradle line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-gradle"}},[e("code",[s._v("docker run "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name redis"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/Users/")])]),s._v("bochenghu"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/onlineinternship/")])]),s._v("redisSlave"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/redis.conf:/")])]),s._v("etc"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/redis/")])]),s._v("redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/Users/")])]),s._v("bochenghu"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/onlineinternship/")])]),s._v("redisSlave"),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/data:/")])]),s._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("rw "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("privileged"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d redis redis"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server "),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("/etc/")])]),s._v("redis"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("appendonly yes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看redis master的内部IP\n"),e("img",{attrs:{src:"/img/blog/20220323172638.png",alt:"image"}})]),s._v(" "),e("div",{staticClass:"language-crmsh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("修改 redis-slave 的配置文件\n# 主地址\nreplicaof 172.17.0.2 6379\n# 主认证\nmasterauth hubocheng\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("重启redis-slave")]),s._v(" "),e("div",{staticClass:"language-crmsh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker restart redis-slave\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("登录 redis master 使用 info 命令查看从的状态")])])]),s._v(" "),e("p",[s._v("如果配置不成功记得检查 redis master 的 bind 和 protected-mode 的设置，看下有没有监听内网地址，否则 redis-slave 没办法通过 redis master 的地址做数据同步\n"),e("img",{attrs:{src:"/img/blog/20220323172629.png",alt:"image"}}),s._v("\n登陆redis master后使用info，显示主从关联成功")]),s._v(" "),e("p",[s._v("原文地址："),e("a",{attrs:{href:"https://segmentfault.com/a/1190000039769819",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://segmentfault.com/a/1190000039769819"),e("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=r.exports}}]);