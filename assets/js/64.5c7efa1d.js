(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{438:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",{attrs:{align:"center"}},[a("img",{attrs:{src:"/img/blog/20220324160454.png"}})]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("操作系统：centOS7")]),s._v(" "),a("p",[s._v("MariaDB: 10.7.3")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("迁移前，请一定做好备份！！！")])]),s._v(" "),a("h2",{attrs:{id:"_1-准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备"}},[s._v("#")]),s._v(" 1.准备")]),s._v(" "),a("p",[s._v("一般情况下，mariadb的data文件夹会在以下路径：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@mariadb")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /var/lib/mysql")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176176")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---- 1 mysql mysql    16384 Jun  4 00:13 aria_log.00000001")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---- 1 mysql mysql       52 Jun  4 00:13 aria_log_control")]),s._v("\ndrwx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------ 2 mysql mysql     4096 Jun  4 00:10 ccnet_db")]),s._v("\ndrwx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------ 2 mysql mysql     4096 Jun  4 00:11 ejbca")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---- 1 mysql mysql 79691776 Jun  4 00:13 ibdata1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---- 1 mysql mysql 50331648 Jun  4 00:13 ib_logfile0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---- 1 mysql mysql 50331648 Jun  4 00:01 ib_logfile1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---- 1 mysql mysql        0 Jun  4 00:03 multi-master.info")]),s._v("\ndrwx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--x--x 2 mysql mysql     4096 Jun  4 00:01 mysql")]),s._v("\ndrwx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------ 2 mysql mysql       19 Jun  4 00:01 performance_schema")]),s._v("\ndrwx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------ 2 mysql mysql     4096 Jun  4 00:11 seafile_db")]),s._v("\ndrwx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------ 2 mysql mysql       19 Jun  4 00:10 seafile_t1")]),s._v("\ndrwx"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------ 2 mysql mysql     8192 Jun  4 00:11 seahub_db")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("但为了安全起见，需要通过CLI确认路径：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用以下命令登入数据库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@mariadb")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -u root -p")]),s._v("\nEnter password:\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检查data目录路径")]),s._v("\nMariaDB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@datadir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@datadir")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("然后关闭所有需要用到mariadb的程序，再执行以下命令关闭mariadb：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop mariadb")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("一定要确认mariadb已经安全地关闭，否则很有可能会使数据库损坏：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status mariadb.service")]),s._v("\n● mariadb.service - MariaDB "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".33 database server\nLoaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/mariadb.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDrop-In: /etc/systemd/system/mariadb.service.d\n└─migrated-from-my.cnf-settings.conf\nActive: inactive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dead"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Mon "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-06-04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:35 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 38s ago\nDocs: man:mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nhttps://mariadb.com/kb/en/library/systemd/\nProcess: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6421")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPost")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" systemctl unset-environment _WSREP_START_POSITION "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProcess: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/mysqld "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQLD_OPTS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_WSREP_NEW_CLUSTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_WSREP_START_POSITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProcess: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6372")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" /usr/bin/galera_recovery "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VAR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VAR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/usr/bin/galera_recovery"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl set-environment "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("_WSREP_START_POSITION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$VAR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProcess: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6370")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" systemctl unset-environment _WSREP_START_POSITION "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMain PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nStatus: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MariaDB server is down"')]),s._v("\n\nJun 04 00:45:55 mariadb-t1 systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started MariaDB "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".33 database server.\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 mariadb-t1 systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Stopping MariaDB "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".33 database server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 mariadb-t1 mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-06-04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140630452087552")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" /usr/sbin/mysqld: Normal "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 mariadb-t1 mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-06-04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140630452087552")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Event Scheduler: Purging the queue. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" events\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 mariadb-t1 mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-06-04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140629698934528")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" InnoDB: FTS optimize thread exiting.\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 mariadb-t1 mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-06-04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:32 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140630452087552")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" InnoDB: Starting shutdown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:33 mariadb-t1 mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-06-04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:33 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140630452087552")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" InnoDB: Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" page_cleaner to finish flushing of buffer pool\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:35 mariadb-t1 mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-06-04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:35 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140630452087552")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" InnoDB: Shutdown completed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" log sequence number "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2940637")]),s._v("\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:35 mariadb-t1 mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6393")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-06-04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:35 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140630452087552")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" /usr/sbin/mysqld: Shutdown complete\nJun 04 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34:35 mariadb-t1 systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Stopped MariaDB "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".33 database server.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("一定要确认最后一行出现了以上内容，否则请不要进行迁移的工作。")])]),s._v(" "),a("h2",{attrs:{id:"_2-迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-迁移"}},[s._v("#")]),s._v(" 2.迁移")]),s._v(" "),a("p",[s._v("再三确认mariadb已经安全地关闭后，在目标路径建立新的data文件夹，在这里我以以下路径作为示例：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/mysql_database\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在根目录下新建一个名为mysql_database的文件夹，并将所有权与组修改为mysql：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /mysql_database")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown mysql:mysql /mysql_database")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("然后将原data目录中的所有文件同步或复制到新的目录中，在这里需要注意保留相关文件的权限。为此，这里有两种方法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用cp命令复制")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -rp /var/lib/mysql/* /mysql_database/")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用rsync命令同步")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsync -av /var/lib/mysql/* /mysql_database/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("如果使用cp命令则需要使用“-p”选项，以便保留文件的属性；如果使用rsync则需要使用“-a”选项，同时建议使用“-v”选项以便观察同步进度。")]),s._v(" "),a("p",[s._v("以上命令选一即可，完成后即可查看相关文件的属性：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新目录中文件的属性")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /mysql_database/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176184")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34 aria_log.00000001\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34 aria_log_control\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:10 ccnet_db\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:11 ejbca\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79691776")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34 ibdata1\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50331648")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":34 ib_logfile0\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50331648")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:01 ib_logfile1\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:03 multi-master.info\ndrwx--x--x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:01 mysql\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:01 performance_schema\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:11 seafile_db\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:10 seafile_t1\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:11 seahub_db\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#原目录中文件的属性")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /var/lib/mysql.bak/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176176")]),s._v("\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:13 aria_log.00000001\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:13 aria_log_control\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:10 ccnet_db\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:11 ejbca\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79691776")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:13 ibdata1\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50331648")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:13 ib_logfile0\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50331648")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:01 ib_logfile1\n-rw-rw---- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:03 multi-master.info\ndrwx--x--x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:01 mysql\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:01 performance_schema\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:11 seafile_db\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:10 seafile_t1\ndrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" mysql mysql     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(" Jun  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 00:11 seahub_db\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("确认无误后，即可将原目录重命名：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv /var/lib/mysql /var/lib/mysql.bak")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注意！在确认迁移成功之前请不要删除原目录，也不要使用mv命令将原目录移动至新路径中！！！")]),s._v(" "),a("h2",{attrs:{id:"_3-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置"}},[s._v("#")]),s._v(" 3.配置")]),s._v(" "),a("p",[s._v("完成数据的迁移后还不能启动，还需要修改mariadb的配置文件，以便让mariadb知道自己的data目录。为此，我们需要在以下文件中添加几行内容：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打开文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/my.cnf")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在[mysqld]块中添加以下内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datadir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql_database/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql_database/mysql.sock\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("因为服务器的socket路径变了，为方面本地client的使用方便，还需要修改client的配置文件，以便让client知道socket的路径：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/my.cnf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加以下内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mysql_database/mysql.sock\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_4-修改service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改service"}},[s._v("#")]),s._v(" 4.修改service")]),s._v(" "),a("p",[s._v("打开service文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /usr/lib/systemd/system/mariadb.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("找到")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ProtectHome")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改为")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ProtectHome")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("执行命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl daemon-reload\n\nsystemctl start mariadb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_5-启动mariadb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动mariadb"}},[s._v("#")]),s._v(" 5.启动MariaDB")]),s._v(" "),a("p",[s._v("执行命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart mariadb")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果一切正常，那么通过以下命令即可发现mariadb处于运行状态：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mariadb-t1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status mariadb")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"参考文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://ngx.hk/2018/06/04/%E4%BF%AE%E6%94%B9%E4%B8%8E%E8%BF%81%E7%A7%BBmariadb%E7%9A%84data%E6%96%87%E4%BB%B6%E5%A4%B9.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("修改与迁移mariadb的data文件夹"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/leinchu/article/details/113397050",target:"_blank",rel:"noopener noreferrer"}},[s._v("Can‘t create test file /home/mysql/data1/localhost.lower-test"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[s._v("#")]),s._v(" 其他")]),s._v(" "),a("p",[s._v("我的博客即将同步至腾讯云开发者社区，邀请大家一同入驻：https://cloud.tencent.com/developer/support-plan?invite_code=xx3sgbvuw66m")])])}),[],!1,null,null,null);a.default=e.exports}}]);