(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{429:function(s,a,n){"use strict";n.r(a);var t=n(2),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"linux下nginx1-16-1升级至1-18-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux下nginx1-16-1升级至1-18-0"}},[s._v("#")]),s._v(" Linux下Nginx1.16.1升级至1.18.0")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("前置条件")]),s._v(" "),a("p",[s._v("本文采用centOS 7.8.2003 版本")]),s._v(" "),a("p",[s._v("通过编译的方式升级")])]),s._v(" "),a("p",[s._v("如何平滑的升级Nginx 1.16.1到1.18.0版本，及升级失败后如何退回")]),s._v(" "),a("h2",{attrs:{id:"一、首先确认当前已经安装nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、首先确认当前已经安装nginx"}},[s._v("#")]),s._v(" 一、首先确认当前已经安装Nginx")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115163443.png",alt:"image-20210115163443330"}})]),s._v(" "),a("h2",{attrs:{id:"二、下载nginx-1-18-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、下载nginx-1-18-0"}},[s._v("#")]),s._v(" 二、下载Nginx 1.18.0")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.18.0.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移动至目标文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" nginx-1.18.0.tar.gz /usr/local/src/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" nginx-1.18.0.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.18.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"三、获取旧版本的安装编译命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、获取旧版本的安装编译命令"}},[s._v("#")]),s._v(" 三、获取旧版本的安装编译命令")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("下面命令中 "),a("code",[s._v("/usr/local/nginx/sbin/nginx")]),s._v(" 是我的nginx安装路径")]),s._v(" "),a("p",[s._v("若路径不一致可根据实际情况进行修改")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115164227.png",alt:"image-20210115164227414"}})]),s._v(" "),a("ul",[a("li",[s._v("此处我们得到了编译参数为")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-stream\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("编译参数可能有出入，此处请根据实际情况替换成你自己获取的参数")])]),s._v(" "),a("h2",{attrs:{id:"四、编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、编译"}},[s._v("#")]),s._v(" 四、编译")]),s._v(" "),a("ul",[a("li",[s._v("此处"),a("code",[s._v("./configure")]),s._v(" 后面的命令为上面获取的编译参数，若想了解此文章的参数具体含义可以点击"),a("a",{attrs:{href:"https://taixingyiji.com/nginx/linuxbuild/onepointsixteen/#%E4%B8%89%E3%80%81%E7%BC%96%E8%AF%91%E6%BA%90%E4%BB%A3%E7%A0%81",target:"_blank",rel:"noopener noreferrer"}},[a("em",[a("strong",[s._v("此处")])]),a("OutboundLink")],1)])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./configure "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-stream\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115164756.png",alt:"image-20210115164756617"}})]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("有些人可能有疑惑，新下载的nginx在执行./configure的时候--prefix指定的目录是需要指向旧的nginx所指向的prefix目录还是随便指向一个就行，答案是需要指向旧版本的nginx的安装目录")])]),s._v(" "),a("ul",[a("li",[s._v("执行make命令")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("注意执行完成后不要执行make install命令")])]),s._v(" "),a("h2",{attrs:{id:"五、平滑升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、平滑升级"}},[s._v("#")]),s._v(" 五、平滑升级")]),s._v(" "),a("h3",{attrs:{id:"_1-首先备份nginx二进制可执行程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-首先备份nginx二进制可执行程序"}},[s._v("#")]),s._v(" 1. 首先备份nginx二进制可执行程序")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx/sbin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(",.bak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115165418.png",alt:"image-20210115165418236"}})]),s._v(" "),a("h3",{attrs:{id:"_2-查看nginx版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看nginx版本"}},[s._v("#")]),s._v(" 2. 查看nginx版本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115165532.png",alt:"image-20210115165531993"}})]),s._v(" "),a("h3",{attrs:{id:"_3-找到nginx-1-18-0新版本的nginx的二进制执行程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-找到nginx-1-18-0新版本的nginx的二进制执行程序"}},[s._v("#")]),s._v(" 3. 找到nginx-1.18.0新版本的nginx的二进制执行程序")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src/nginx-1.18.0/objs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115165738.png",alt:"image-20210115165738521"}})]),s._v(" "),a("p",[s._v("上面的这个"),a("code",[s._v("nginx")]),s._v("就是我们要拿到的新版本的nginx可执行程序文件。")]),s._v(" "),a("h3",{attrs:{id:"_4-使用nginx-1-18-0的二进制文件将nginx-1-16-1的二进制文件进行强制覆盖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-使用nginx-1-18-0的二进制文件将nginx-1-16-1的二进制文件进行强制覆盖"}},[s._v("#")]),s._v(" 4. 使用nginx-1.18.0的二进制文件将nginx-1.16.1的二进制文件进行强制覆盖")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx /usr/local/nginx/sbin/nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115165950.png",alt:"image-20210115165950374"}})]),s._v(" "),a("h3",{attrs:{id:"_5-设定旧的服务不再接收用户请求-下线-，新服务启动子进程接收用户请求-上线"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-设定旧的服务不再接收用户请求-下线-，新服务启动子进程接收用户请求-上线"}},[s._v("#")]),s._v(" 5. 设定旧的服务不再接收用户请求(下线)，新服务启动子进程接收用户请求(上线)")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115170502.png",alt:"image-20210115170502120"}})]),s._v(" "),a("ul",[a("li",[s._v("找到nginx父进程的pid号，现在对其发送"),a("code",[s._v("USR2")]),s._v("信号")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-USR2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6084")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设定新的子进程开始接收用户的访问请求,旧的不再接受用户的访问请求")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("再次查看进程")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115170722.png",alt:"image-20210115170722930"}})]),s._v(" "),a("p",[s._v("现在是nginx的新老版本的进程共存的一种情况。虽然现在旧版本的nginx进程还存在，但是已经不再接受用户的请求了。除此之外，旧版本的nginx进程也依然处于监听的状态，我们通过lsof命令可以看到，此处端口号为父进程端口号")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/blog/20210115170839.png",alt:"image-20210115170839128"}})]),s._v(" "),a("p",[s._v("虽然在监听，但实际不会处理新连接，因为fd已经从epoll中移出了。另外，旧master是新master的父进程，所以新master才能共享打开的监听端口。保留旧版本的master是为了方便回滚（当然你可以发信号QUIT或者直接杀掉进程）")]),s._v(" "),a("h3",{attrs:{id:"_6-进行旧服务进程的关闭"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-进行旧服务进程的关闭"}},[s._v("#")]),s._v(" 6. 进行旧服务进程的关闭")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-WINCH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6084")]),s._v("                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进行旧服务进程的关闭，该pid号是旧版本的nginx的master进程的pid号")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("再次查看当前nginx进程")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115171220.png",alt:"image-20210115171220531"}})]),s._v(" "),a("p",[s._v("可以看到现在的旧版本的nginx的worker进程已经全部被杀死了，只剩下的旧版本nginx的master进程\n确定升级没有任何问题的话，那么现在我们可以把这个master进程给杀死掉。可以用kill -QUIT把旧master进程杀掉。方法已经教给大家了，但是这里我先不杀死，因为我还要往下演示如何回退。")]),s._v(" "),a("h3",{attrs:{id:"_7-查看当前nginx的版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-查看当前nginx的版本"}},[s._v("#")]),s._v(" 7. 查看当前nginx的版本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115171348.png",alt:"image-20210115171348077"}})]),s._v(" "),a("p",[s._v("可以看到现在已经升级成功了。\n还可以访问一下")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/blog/20210115171439.png",alt:"image-20210115171439488"}})]),s._v(" "),a("h2",{attrs:{id:"六、如何退回到1-16-1版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、如何退回到1-16-1版本"}},[s._v("#")]),s._v(" 六、如何退回到1.16.1版本")]),s._v(" "),a("p",[a("strong",[s._v("这种情况主要是用于当新版本的nginx升级失败之后，我们立马回退到旧版本的nginx")])]),s._v(" "),a("h3",{attrs:{id:"_1-将旧版本的nginx二进制文件强行覆盖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-将旧版本的nginx二进制文件强行覆盖"}},[s._v("#")]),s._v(" 1. 将旧版本的nginx二进制文件强行覆盖")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx/sbin/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" nginx.bak  nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("查看进程")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115171732.png",alt:"image-20210115171732253"}})]),s._v(" "),a("h3",{attrs:{id:"_2-向旧版本nginx进程发送hup信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-向旧版本nginx进程发送hup信号"}},[s._v("#")]),s._v(" 2. 向旧版本nginx进程发送HUP信号")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-HUP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6084")]),s._v("                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意这是旧版本的nginx进程pid号")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("说明")]),s._v(" "),a("p",[s._v("这个命令就相当与reload指令的作用，把旧的nginx的worker进程拉起来，但是咱们并不是直接使用reload的方式来执行，而是发送HUP信号，它会在没有worker进程时启动worker进程，这点需要注意一下。")])]),s._v(" "),a("ul",[a("li",[s._v("此时再次查看进程")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115171959.png",alt:"image-20210115171959495"}})]),s._v(" "),a("p",[s._v("发现多了worker进程，多出来的部分是旧版本的nginx进程。")]),s._v(" "),a("h3",{attrs:{id:"_3-让新版本的服务停止接收用户请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-让新版本的服务停止接收用户请求"}},[s._v("#")]),s._v(" 3. 让新版本的服务停止接收用户请求")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-USR2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31276")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时，接收用户请求的是旧版本的nginx进程。新版本的nginx进程不再接受用户请求")]),s._v(" "),a("h3",{attrs:{id:"_4-进行新版本服务进程的关闭"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-进行新版本服务进程的关闭"}},[s._v("#")]),s._v(" 4. 进行新版本服务进程的关闭")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-WINCH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31276")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("查看一下进程")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115172333.png",alt:"image-20210115172333411"}})]),s._v(" "),a("p",[s._v("现在，旧版本已经回退成功了，我们可以把新版本的nginx的master进程发送QUIT进程将其退出。")]),s._v(" "),a("h3",{attrs:{id:"_5-kill掉新版本nginx进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-kill掉新版本nginx进程"}},[s._v("#")]),s._v(" 5. kill掉新版本nginx进程")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-QUIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31276")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115172511.png",alt:"image-20210115172511809"}})]),s._v(" "),a("ul",[a("li",[s._v("再次查看一下版本")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./nginx  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/img/blog/20210115172610.png",alt:"image-20210115172609987"}})]),s._v(" "),a("p",[s._v("退回成功")]),s._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/FengGeBlog/p/13536009.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx版本升级：从nginx1.16.1升级到nginx1.18.0，以及升级失败如何回退"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);